version: "3.9"

services:
  stonkmarket:
    build: .
    command: gunicorn -k uvicorn.workers.UvicornWorker -w ${GUNICORN_WORKERS:-1} main:app --bind 0.0.0.0:8000 --access-logfile - --forwarded-allow-ips="*"
    env_file:
      - .env
    environment:
      - DB_PATH=${DB_PATH:-/data/dips.sqlite}
      - HTTPS=${HTTPS:-false}
      - DOMAIN=${DOMAIN:-}
      - ADMIN_USER=${ADMIN_USER:-admin}
      - ADMIN_PASS=${ADMIN_PASS:-admin}
      - AUTH_SECRET=${AUTH_SECRET:-change-me-secret}
      - SCHEDULER_ENABLED=${SCHEDULER_ENABLED:-true}
    volumes:
      - ./data:/data
    ports:
      - "8000:8000"
    restart: unless-stopped

networks:
  default:
    name: stonkmarket_net
